(async function(){if(document.getElementById("hamburg-chatbot"))return;const css=document.createElement("style");css.textContent=`
        #hamburg-chatbot {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: white;
            border: 1px solid #ccc;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 10000;
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
        }
        #hamburg-chatbot.hidden { display: none; }
        #chatbot-header {
            background: #0072c6;
            color: white;
            padding: 10px;
            font-size: 16px;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }
        #chatbot-messages {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
        }
        #chatbot-input {
            display: flex;
            padding: 10px;
            border-top: 1px solid #ccc;
        }
        #chatbot-input input {
            flex: 1;
            padding: 5px 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
        }
        #chatbot-input button {
            margin-left: 8px;
            padding: 6px 10px;
            background: #0072c6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
    `;document.head.appendChild(css);const chatbot=document.createElement("div");chatbot.id="hamburg-chatbot";chatbot.innerHTML=`
        <div id="chatbot-header">Hamburg Services Chatbot</div>
            <div id="chatbot-messages"></div>
            <div id="chatbot-input">
                <input type="text" placeholder="Frage mich etwas..." />
            <button>Send</button>
        </div>
    `;document.body.appendChild(chatbot);const input=chatbot.querySelector("input");const button=chatbot.querySelector("button");const messages=chatbot.querySelector("#chatbot-messages");function appendMessage(from,text){const div=document.createElement("div");div.textContent=`${from}: ${text}`;messages.appendChild(div);messages.scrollTop=messages.scrollHeight}const chatHistory=JSON.parse(localStorage.getItem("chatbotSession")||"[]");chatHistory.forEach(m=>appendMessage(m.from,m.text));function sendMessage(){const userText=input.value.trim();if(!userText)return;appendMessage("Du",userText);input.value="";const message={from:"You",text:userText};chatHistory.push(message);fetchAnswer(userText)}async function fetchAnswer(userText){try{const response=await fetch("http://172.236.193.62/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:userText,url:window.location.href})});if(!response.ok)throw new Error("Server error");const data=await response.json();const botReply=data.answer||"Entschuldigung, ich habe keine Antowort finden kÃ¶nnen.";appendMessage("Bot",botReply);chatHistory.push({from:"Bot",text:botReply});localStorage.setItem("chatbotSession",JSON.stringify(chatHistory))}catch(err){console.error(err);appendMessage("Bot","Ups! Ein Fehler ist aufgetreten.")}}button.onclick=sendMessage;input.onkeydown=e=>{if(e.key==="Enter")sendMessage()};window.addEventListener("beforeunload",()=>{localStorage.setItem("chatbotSession",JSON.stringify(chatHistory))})})();